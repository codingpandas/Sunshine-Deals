DROP DATABASE IF EXISTS SUNSHINEDEALS;
DROP DATABASE IF EXISTS sunshinedeals;

CREATE DATABASE sunshinedeals;
CREATE USER 'shinetheweb'@'localhost' IDENTIFIED BY 'urmysunshine';

USE sunshinedeals;
GRANT ALL ON sunshinedeals.* TO 'shinetheweb'@'localhost';

DROP TABLE IF EXISTS ACCOUNTS;
DROP TABLE IF EXISTS CART;
DROP TABLE IF EXISTS PURCHASES;
DROP TABLE IF EXISTS LOCATIONS;
DROP TABLE IF EXISTS COUPONS;

CREATE TABLE ACCOUNTS (
	ACCT_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	ACCT_NAME VARCHAR(30) UNIQUE,
	ACCT_PASS varchar(40),
	ACCT_EMAIL varchar(32),
	ACCT_SQUEST varchar(100),
	ACCT_SANSER varchar(100),
	ACCT_TYPE INT NOT NULL,
	ACCT_JOIN TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE COUPONS (
	COUP_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	COUP_NAME varchar(30) UNIQUE,
	COUP_TOTAL INT,
	COUP_LEFT INT,
	COUP_PRICE DECIMAL(6,2),
	COUP_CATNAME VARCHAR(20),
	COUP_VENDOR VARCHAR(30),
	COUP_DESC VARCHAR(1000),
	COUP_IMGLOC VARCHAR(200),
	COUP_START TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	COUP_EXPR TIMESTAMP
);

CREATE TABLE CART (
	CART_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	CART_ACCT_ID INT NOT NULL,
	CART_COUP_ID INT NOT NULL,
	CART_QUAN INT,
	CART_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE PURCHASES (
	PUR_ID INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	PUR_ACCT_ID INT NOT NULL,
	PUR_VENDNAME VARCHAR(30) NOT NULL,
	PUR_COUP_ID INT NOT NULL,
	PUR_QUAN INT NOT NULL,
	PUR_PRICE DECIMAL(10,2) NOT NULL,
	PUR_PAID DECIMAL(10,2) NOT NULL,
	PUR_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	PUR_BADD varchar(50) NOT NULL,
	PUR_BCTY varchar(15) NOT NULL,
	PUR_BSTA char(2) NOT NULL,
	PUR_BZIP char(5) NOT NULL,
	PUR_BNAME varchar(30) NOT NULL,
	PUR_CCN varchar(50) NOT NULL,
	PUR_CCLFN char(5) NOT NULL,
	PUR_CCEX DATE NOT NULL,
	PUR_CCSN varchar(50) NOT NULL
);

CREATE UNIQUE INDEX ACCT_INDEX ON ACCOUNTS(ACCT_ID, ACCT_NAME);
CREATE UNIQUE INDEX COUP_INDEX ON COUPONS(COUP_ID, COUP_NAME);
CREATE INDEX CART_INDEX ON CART(CART_ID ASC);
CREATE INDEX PUR_INDEX ON PURCHASES(PUR_ID ASC);

ALTER TABLE CART ADD CONSTRAINT CARTFK_ACCT FOREIGN KEY(CART_ACCT_ID) REFERENCES ACCOUNTS(ACCT_ID);
ALTER TABLE CART ADD CONSTRAINT CARTFK_COUP FOREIGN KEY(CART_COUP_ID) REFERENCES COUPONS(COUP_ID);
ALTER TABLE PURCHASES ADD CONSTRAINT PURFK_ACCT FOREIGN KEY(PUR_ACCT_ID) REFERENCES ACCOUNTS(ACCT_ID);
ALTER TABLE PURCHASES ADD CONSTRAINT PURFK_COUP FOREIGN KEY(PUR_COUP_ID) REFERENCES COUPOUNS(COUP_ID);

INSERT INTO ACCOUNTS (ACCT_NAME, ACCT_PASS, ACCT_EMAIL, ACCT_SQUEST, ACCT_SANSER, ACCT_TYPE) VALUES ('Bob',SHA1(MD5('magic133')), 'bob@se133.com', 'Who is your best friend?', SHA1(MD5('Google')), 1);
INSERT INTO ACCOUNTS (ACCT_NAME, ACCT_PASS, ACCT_EMAIL, ACCT_SQUEST, ACCT_SANSER, ACCT_TYPE) VALUES ('Joe',SHA1(MD5('magic133')), 'joe@se133.com', 'Who is your best friend?', SHA1(MD5('Jane')), 0);
INSERT INTO ACCOUNTS (ACCT_NAME, ACCT_PASS, ACCT_EMAIL, ACCT_SQUEST, ACCT_SANSER, ACCT_TYPE) VALUES ('Jane',SHA1(MD5('magic133')), 'jane@se133.com', 'Who is your best friend?', SHA1(MD5('Joe')), 0);
INSERT INTO ACCOUNTS (ACCT_NAME, ACCT_PASS, ACCT_EMAIL, ACCT_SQUEST, ACCT_SANSER, ACCT_TYPE) VALUES ('Zelda',SHA1(MD5('magic133')), 'zelda@se133.com', 'Who is your best friend?', SHA1(MD5('No one')), 1);

INSERT INTO COUPONS (COUP_NAME, COUP_TOTAL, COUP_LEFT, COUP_PRICE, COUP_CATNAME, COUP_VENDOR, COUP_DESC, COUP_IMGLOC, COUP_EXPR) VALUES ('Car Part',10,10,49.99,'Automotive','Bob','Coupon desc goes here: It does something to someone that makes someone else happy or at least that someone hopes so!', 'http://gre.gd/1a', '2012-05-30 23:59:59');
INSERT INTO COUPONS (COUP_NAME, COUP_TOTAL, COUP_LEFT, COUP_PRICE, COUP_CATNAME, COUP_VENDOR, COUP_DESC, COUP_IMGLOC, COUP_EXPR) VALUES ('Baby Stuff',10,10,49.99,'Family Care','Zelda','Coupon desc goes here: It does something to someone that makes someone else happy or at least that someone hopes so!', 'http://gre.gd/19', '2012-05-30 23:59:59');
INSERT INTO COUPONS (COUP_NAME, COUP_TOTAL, COUP_LEFT, COUP_PRICE, COUP_CATNAME, COUP_VENDOR, COUP_DESC, COUP_IMGLOC, COUP_EXPR) VALUES ('Travel Abroad',10,10,49.99,'Travel','Bob','Coupon desc goes here: It does something to someone that makes someone else happy or at least that someone hopes so!', 'http://gre.gd/18', '2012-05-30 23:59:59');
INSERT INTO COUPONS (COUP_NAME, COUP_TOTAL, COUP_LEFT, COUP_PRICE, COUP_CATNAME, COUP_VENDOR, COUP_DESC, COUP_IMGLOC, COUP_EXPR) VALUES ('Spicy Food Thingy',10,10,49.99,'Food','Zelda','Coupon desc goes here: It does something to someone that makes someone else happy or at least that someone hopes so!', 'http://gre.gd/1b', '2012-05-30 23:59:59');
INSERT INTO COUPONS (COUP_NAME, COUP_TOTAL, COUP_LEFT, COUP_PRICE, COUP_CATNAME, COUP_VENDOR, COUP_DESC, COUP_IMGLOC, COUP_EXPR) VALUES ('Sofas',10,10,49.99,'Living','Zelda','Coupon desc goes here: It does something to someone that makes someone else happy or at least that someone hopes so!', 'http://gre.gd/1c', '2012-05-30 23:59:59');

INSERT INTO CART (CART_ACCT_ID, CART_COUP_ID, CART_QUAN) VALUES (1,3,4);
INSERT INTO CART (CART_ACCT_ID, CART_COUP_ID, CART_QUAN) VALUES (1,1,3);
INSERT INTO CART (CART_ACCT_ID, CART_COUP_ID, CART_QUAN) VALUES (2,1,2);
INSERT INTO CART (CART_ACCT_ID, CART_COUP_ID, CART_QUAN) VALUES (2,5,2);
INSERT INTO CART (CART_ACCT_ID, CART_COUP_ID, CART_QUAN) VALUES (3,2,6);
